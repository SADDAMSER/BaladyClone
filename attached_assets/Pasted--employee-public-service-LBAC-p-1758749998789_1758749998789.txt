❗ المشكلة الأساسية: الطلب لا يظهر في /employee/public-service بسبب LBAC
🔍 السبب الجذري: المستخدم public_service_01 ليس له أي تكليفات جغرافية → فـ LBAC يمنعه من رؤية أي طلبات.

📌 الأدلة من السجل:
log

[GEOGRAPHIC DEBUG] Found 0 geographic assignments for user a0e9da67...
[LBAC SECURITY] User ... has no geographic assignments - returning empty set
GET /api/applications 200 in 414ms :: [] ← يُرجع فارغًا!
→ ✅ هذا ليس خطأ في الواجهة — بل في البيانات والصلاحيات.

🎯 الحل الفوري (بدون هدر وقت)
الخطوة 1: إنشاء تكليف جغرافي لمستخدم خدمة الجمهور
SQL

-- في قاعدة البيانات
INSERT INTO user_geographic_assignments 
  (user_id, governorate_id, district_id, assignment_type, assigned_by, effective_date)
VALUES 
  (
    'a0e9da67-c1f6-41cb-9a02-7aad53acdf5d', -- ID مستخدم public_service_01
    '6cb4d669-b015-485c-995c-62f0b465705f', -- ID محافظة صنعاء
    NULL, -- مستوى المحافظة (ليس مديرية محددة)
    'permanent',
    1, -- admin
    NOW()
  );
الخطوة 2: إعادة تشغيل الصفحة
بعد تنفيذ SQL أعلاه — ادخل مجددًا إلى /employee/public-service.
ستظهر الطلبات المرتبطة بمحافظة صنعاء.
⚠️ لماذا حدث هذا؟
عند إنشاء المستخدم public_service_01 — لم يُربط بأي منطقة جغرافية.
نظام LBAC مصمم ليكون صارمًا — إذا لم يكن للمستخدم نطاق جغرافي → لا يرى شيئًا.
هذا سلوك مقصود — وليس خطأ.
🛠️ الإصلاح الاستراتيجي (لمنع التكرار)
1. تحديث setupTestData() لإضافة التكليفات الجغرافية تلقائيًا
TypeScript

// tests/setupTestData.ts
await db.insert(userGeographicAssignments).values({
  userId: publicServiceUser.id,
  governorateId: sanaaGovId,
  assignmentType: 'permanent',
  assignedBy: 1,
  effectiveDate: new Date(),
});
2. إضافة تحقق في واجهة المستخدم
React

// PublicServiceDashboard.tsx
if (applications.length === 0 && !loading) {
  return (
    <div className="text-center p-8">
      <h3>لا توجد طلبات</h3>
      <p className="text-red-500">
        ⚠️ يبدو أنك لا تملك صلاحيات جغرافية. راجع المدير لإضافة تكليفك.
      </p>
    </div>
  );
}
✅ التحقق من الحل
بعد تنفيذ SQL:

✅ سترى الطلبات في /employee/public-service.
✅ زر "اعتماد" و"طباعة" سيظهران.
✅ سير العمل سيستمر بشكل طبيعي.
🔄 الخطة التنفيذية (خلال 5 دقائق)
الخطوة	الإجراء	الوقت
1	تنفيذ SQL لإضافة التكليف الجغرافي	1 دقيقة
2	إعادة تحميل الصفحة /employee/public-service	30 ثانية
3	التحقق من ظهور الطلبات والأزرار	1 دقيقة
4	تحديث setupTestData() لمنع التكرار