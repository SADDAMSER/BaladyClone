إلى: المساعد (Assistant) والمعماري (Architect)
من: قائد المشروع
التاريخ: 24 سبتمبر 2025
الموضوع: أمر نهائي بإعادة تنفيذ واجهة تقديم الطلب بنسبة 100% — ثم إكمال باقي مهام المرحلة 1 وفق الخطة المعتمدة

📌 السادة الكرام،
بعد مراجعة دقيقة للكود في المستودع BaladyClone — تبين أن واجهة تقديم الطلب (المهمة 1.1) لم تُنفَّذ وفق المتطلبات الفنية الدقيقة، رغم وجود هيكل أولي.

❗ لا يمكن المتابعة بأي مهمة أخرى في المرحلة 1 — حتى يتم إكمال واجهة تقديم الطلب بنسبة 100%.

سأحدد لكم الآن قائمة الإصلاحات الإلزامية — ثم خطة إكمال باقي المهام — وكلها يجب تنفيذها بدقة وحرفية.

🚨 أولاً: قائمة الإصلاحات الإلزامية لواجهة تقديم الطلب (المهمة 1.1)
⚠️ ما تم تنفيذه بشكل غير كامل أو خاطئ:
البند	الحالة	المتطلبات المفقودة
1. حقول البحث الذكية	❌ غير مُنفذ	لا يوجد تعبئة تلقائية عند إدخال رقم الهوية أو الهاتف.
2. القوائم المنسدلة المترابطة	❌ غير مُنفذ	فقط محافظة — لا مديرية ← عزلة ← قطاع ← وحدة جوار.
3. عرض GeoTIFF	❌ غير مُنفذ	لا يوجد عرض للملف إن وُجد — ولا آلية لتحميله لاحقًا.
4. صفحة منبثقة للأسقاطات القديمة	❌ غير مُنفذ	لا يوجد Modal عند اختيار "رخصة بناء قديم" أو "تسجيل اسقاط قديم".
5. تصنيف البناء → نوع السكني	❌ غير مُنفذ	لا يوجد حقول buildingType أو residentialType.
6. نقل الخريطة للخطوة 2	❌ غير مُنفذ	الخريطة ما زالت في الخطوة 4 — وزر تحديد الإحداثيات غير موجود في الخطوة 2.
7. حقل "المساحة بحسب الوثيقة"	❌ غير مُنفذ	لا يوجد الحقل في الخطوة 4.
8. حقل "حالة الوثيقة"	❌ غير مُنفذ	لا يوجد الحقل (معمدة، مدفوع الضريبة...).
9. زر لإضافة أكثر من وثيقة	❌ غير مُنفذ	لا يوجد Modal لإدارة عدة وثائق.
✅ ثانياً: الخطة التنفيذية التفصيلية لإصلاح واجهة تقديم الطلب
🧩 المهمة 1.1A: إصلاح واجهة تقديم الطلب (9 خطوات)
[ ] الخطوة 1: حقول البحث الذكية + تعبئة تلقائية
عند إدخال رقم الهوية أو رقم الهاتف — استدعاء API:
TypeScript

GET /api/applicants?nationalId={value} OR phone={value}
إذا وُجد — تعبئة الحقول تلقائيًا: الاسم، البريد، الهاتف.
إضافة زر "تحميل صورة الهوية" + مربع عرض للصورة.
[ ] الخطوة 2: القوائم المنسدلة المترابطة + الخريطة + GeoTIFF
القوائم: محافظة ← مديرية ← عزلة ← قطاع ← وحدة جوار.
عند اختيار "وحدة جوار" — عرض GeoTIFF إن وُجد (من geo_jobs table).
إذا لم يُوجد — عرض رسالة: "سيتم تحميل المخطط لاحقًا بواسطة مدير النظام".
نقل InteractiveDrawingMap من الخطوة 4 إلى هنا — مع زر "تحديد الإحداثيات".
[ ] الخطوة 3: نوع القرار + الصفحات المنبثقة
عند اختيار:
"إصدار رخصة بناء قديم" أو "تسجيل اسقاط قديم" → فتح Modal لإدخال:
اسم المهندس.
رفع ملف الاسقاط القديم.
"إصدار رخصة بناء جديد" → فتح قائمة تصنيف البناء:
سكني → ثم نوع السكني (خاص، نموذجي...).
تجاري.
صناعي.
[ ] الخطوة 4: بيانات الملكية + المرفقات
إضافة حقل: "المساحة بحسب الوثيقة (م²)".
إضافة حقل: "حالة الوثيقة" ← قائمة منسدلة:
معمدة.
مدفوع الضريبة.
معمدة من المحكمة.
إضافة زر: "+ إضافة وثيقة أخرى" → يفتح Modal لإدارة عدة وثائق.
[ ] الخطوة 5: تأكيد الطلب
مراجعة شاملة لكل البيانات.
توليد رقم طلب فريد.
إشعار: "تم تسجيل الطلب وجاري مراجعته".
🎯 ثالثاً: خطة إكمال باقي مهام المرحلة 1 (بعد إغلاق المهمة 1.1A)
⚙️ المهمة 1.2: إكمال سير العمل الإداري
 تمييز المسارين:
مسار مكتبي: توقيع يدوي → سداد نقدي.
مسار بوابة: توقيع رقمي → دفع إلكتروني.
 إشعار موظف الصندوق عند الطباعة.
 في حالة "اسقاط قديم": رفع Shapefile → معالجة → رسم الشارع → اعتماد.
📱 المهمة 1.3: تكامل المسح الميداني + أدوات المراجع الفني
 استخدام Leaflet/OpenLayers + أدوات الرسم (Leaflet.draw).
 تفعيل Snapping + التحقق الطوبولوجي.
 استيراد Shapefile/DWG.
 التحليل المكاني (مسار أمثل، وصولية...).
📄 المهمة 1.4: محرك إصدار القرارات + المعالجة الجغرافية
 نقطة نهاية: /api/v1/survey/upload_shp.
 وحدة معالجة: GeoPandas + Shapely + pyproj.
 تصنيف الاتجاهات (4 و 8 اتجاهات).
 توليد PDF: خريطة + جدول إحداثيات + باركود.
🔐 المهمة 1.5: الأمان + سير العمل
 State Machine بالحالات التفصيلية.
 إشعارات لكل حالة.
 تشفير PII + Digital Signatures.
🏆 معايير اكتمال المرحلة 1 (Definition of Done)
لا يمكن إغلاق المرحلة 1 إلا بعد تحقيق:

البند	الشرط
✅ واجهة تقديم الطلب	100% وفق المتطلبات التسع أعلاه.
✅ سير العمل الإداري	تمييز المسارين + إشعار الصندوق + معالجة الأسقاطات.
✅ أدوات المراجع الفني	Leaflet.draw + Snapping + استيراد Shapefile.
✅ محرك القرارات	توليد PDF + تصنيف الاتجاهات + معالجة SHP.
✅ الأمان وسير العمل	State Machine + إشعارات + تشفير.
🔄 آلية العمل خلال المرحلة 1
الخطوة	دوري (الخبير المستشار)	دورك (أنت + فريق Replit)
1. اختيار المهمة الفرعية	أرسل لك تحليل + أوامر + كود	لا شيء — فقط القراءة
2. التنفيذ	لا أتدخل	تنفذ في Replit باستخدام المساعد والمعماري
3. النتائج	أنتظر منك النتائج أو الأخطاء	تزودني بالنتائج أو لقطات الشاشة
4. التصحيح / التحسين	أرسل لك التصحيح أو البديل	تنفذ التصحيح وتزودني بالنتيجة
✅ ختامًا
🎯 واجهة تقديم الطلب هي البوابة — ويجب أن تكون مثالية.
🚀 ما تم إنجازه هو مجرد بداية — والأهم قادم.
👑 أنت تقود مشروعًا استراتيجيًا — وأنا هنا لدعمك في كل خطوة — وفقًا لاستراتيجيتنا: أنا الخبير المستشار — وأنت المنفذ والمتحكم.

انتهى الأمر.
لا استثناءات. لا تأخير. لا انحراف.

— قائد المشروع

