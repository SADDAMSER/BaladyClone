
🧪 ثانيًا: اختبارات القبول لواجهة تقديم الطلب (المهمة 1.1A)
سأجهز لك الآن اختبارات القبول الشاملة — وفق القالب الذي طلبته — مع تغطية كل المتطلبات الوظيفية والأمنية والأداء والتكامل.

📋 قالب اختبارات القبول: المهمة 1.1A — واجهة تقديم الطلب
TypeScript

// tests/acceptance/surveying-decision-form.test.ts
import { test, expect } from '@playwright/test';

test.describe('واجهة تقديم الطلب — اختبارات القبول', () => {

  // 🧪 الاختبار الوظيفي: الخطوة 1 — حقول البحث الذكية
  test('يجب أن يملأ الحقول تلقائيًا عند إدخال رقم هوية مسجل', async ({ page }) => {
    await page.goto('/services/surveying-decision');
    await page.fill('input[name="nationalId"]', '123456789');
    await page.waitForTimeout(1000);
    const name = await page.inputValue('input[name="applicantName"]');
    expect(name).toBe('علي محمد');
  });

  // 🧪 الاختبار الوظيفي: الخطوة 2 — عرض GeoTIFF
  test('يجب أن تعرض GeoTIFF إن وُجد عند اختيار وحدة جوار', async ({ page }) => {
    await page.selectOption('select[name="neighborhoodUnit"]', 'uuid-وحدة-جوار-1');
    await page.waitForSelector('img[src*="geotiff"]');
    const geoTiff = await page.$('img[src*="geotiff"]');
    expect(geoTiff).not.toBeNull();
  });

  // 🧪 الاختبار الوظيفي: الخطوة 3 — Modal للأسقاطات القديمة
  test('يجب أن يفتح Modal عند اختيار "إصدار رخصة بناء قديم"', async ({ page }) => {
    await page.selectOption('select[name="decisionType"]', 'oldLicense');
    await page.waitForSelector('text=اسم المهندس');
    const modal = await page.$('text=اسم المهندس');
    expect(modal).not.toBeNull();
  });

  // 🧪 الاختبار الوظيفي: الخطوة 4 — حقل "المساحة بحسب الوثيقة"
  test('يجب أن يحتوي النموذج على حقل "المساحة بحسب الوثيقة"', async ({ page }) => {
    const areaField = await page.$('input[name="documentArea"]');
    expect(areaField).not.toBeNull();
  });

  // 🧪 الاختبار الأمني: التحقق من LBAC
  test('يجب أن لا يتمكن المستخدم من رؤية طلبات خارج نطاقه الجغرافي', async ({ page }) => {
    await page.goto('/services/surveying-decision');
    await page.selectOption('select[name="governorate"]', 'uuid-عدن');
    const error = await page.$('text=غير مصرح لك');
    expect(error).not.toBeNull();
  });

  // ⚡ الاختبار الأداء: وقت الاستجابة
  test('يجب أن يكون وقت استجابة النموذج < 2 ثانية', async ({ page }) => {
    const startTime = Date.now();
    await page.goto('/services/surveying-decision');
    const endTime = Date.now();
    expect(endTime - startTime).toBeLessThan(2000);
  });

  // 📱 الاختبار التكاملي: مزامنة البيانات مع التطبيق
  test('يجب أن تُزامن بيانات الطلب مع تطبيق المساح', async ({ page }) => {
    await page.fill('input[name="applicantName"]', 'علي محمد');
    await page.click('button[type="submit"]');
    await page.waitForSelector('text=تم تسجيل الطلب');
    // تحقق من ظهور الطلب في تطبيق المساح
    const surveyApp = await page.context().newPage();
    await surveyApp.goto('/employee/engineer');
    await surveyApp.waitForSelector('text=علي محمد');
    const request = await surveyApp.$('text=علي محمد');
    expect(request).not.toBeNull();
  });
});
📊 قالب تقرير نتائج الاختبار (جاهز للتعبئة)
Markdown

### 📊 تقرير نتائج الاختبار: المهمة 1.1A — واجهة تقديم الطلب

#### ✅ 1. المتطلبات الوظيفية
- [x] الخطوة 1: حقول البحث الذكية + تعبئة تلقائية
- [x] الخطوة 2: القوائم المنسدلة + الخريطة + GeoTIFF
- [x] الخطوة 3: نوع القرار + Modal
- [ ] الخطوة 4: حقل "المساحة بحسب الوثيقة" ← ❌ لم يُنفَّذ
- [ ] الخطوة 4: حقل "حالة الوثيقة" ← ❌ لم يُنفَّذ
- [ ] الخطوة 4: زر "+ إضافة وثيقة أخرى" ← ❌ لم يُنفَّذ
- [x] الخطوة 5: تأكيد الطلب + إشعار

#### 🧪 2. اختبارات القبول
- [x] الاختبار الوظيفي: حقول البحث الذكية → ✅ نجح
- [x] الاختبار الوظيفي: عرض GeoTIFF → ✅ نجح
- [x] الاختبار الوظيفي: Modal للأسقاطات القديمة → ✅ نجح
- [ ] الاختبار الوظيفي: حقل "المساحة بحسب الوثيقة" → ❌ فشل
- [x] الاختبار الأمني: LBAC → ✅ نجح
- [x] الاختبار الأداء: وقت الاستجابة → ✅ نجح
- [x] الاختبار التكاملي: مزامنة البيانات → ✅ نجح

#### ❌ 3. الأخطاء
- الخطأ 1: حقل "المساحة بحسب الوثيقة" غير موجود → تم إصلاحه.
- الخطأ 2: حقل "حالة الوثيقة" غير موجود → قيد الإصلاح.
- الخطأ 3: زر "+ إضافة وثيقة أخرى" غير موجود → قيد الإصلاح.

#### 📈 4. مؤشرات الأداء
- وقت الاستجابة: 1.2s → ✅ مقبول.
- تغطية الاختبارات: 85% → ⚠️ يحتاج تحسين.

✅ **جاهز للانتقال للمهمة التالية.**  
❌ **غير جاهز — يحتاج إصلاح الأخطاء.**
🔄 ثالثًا: آلية العمل من الآن فصاعدًا
📥 سأستلم منك تقرير نتائج الاختبار — بعد تشغيل الاختبارات.
🔍 سأتحقق من التقرير — وأتأكد من اجتياز 100% من الاختبارات.
✅ سأُعلن الإنجاز — فقط إذا كانت النتيجة 100% نجاح.
🛠️ إذا فشل أي اختبار — سأرسل لك التصحيح → ثم تعيد الاختبار → ترسل التقرير.
✅ ختامًا
🎯 هذا هو الطريق الصحيح — لا مجال للتقريب أو التساهل.
🚀 نحن نبني نظامًا وطنيًا — ويجب أن يكون مثالياً.
👑 أنت تقود مشروعًا استراتيجيًا — وأنا هنا لدعمك في كل خطوة — وفقًا لاستراتيجيتنا: أنا الخبير المستشار — وأنت المنفذ والمتحكم.

